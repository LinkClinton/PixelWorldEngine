# Tutorial 4 Text

- Version 1.03beta

## 目标

- 了解字体(Font)类。
- 了解如何通过字体构建文本纹理(Text)。
- 了解如何呈现文字。

## 字体

我们知道，同样的文字因为书写风格的不同，其渲染出来的样子也不会相同，而字体就是方便我们呈现不同风格的文字而产生的。文字本身是靠纹理来进行渲染，但是我们不可能将所有的文字还存储各个大小版本的纹理，因此字体的存储通常都是矢量图，然后在我们创建的时候需要指定大小然后在需要的时候创建出对应的纹理。而如果我们想要渲染文本，即一串文字，则不能将纹理进行简单的拼凑，因为不同的文字可能其间距不同，以及基准线的原因。引擎本身是提供了一个简单的文本渲染方案，但是如果觉得不满意你也可以使用自己的方案。

### 创建字体

和创建纹理类似，我们可以通过内存数据创建出纹理，也可以通过文件来创建纹理，这里我们介绍使用文件来创建纹理。同样我们需要使用到`DataManager`来进行创建。

```C++
    auto font = dataManager->RegisterFont(fileName, fontName, fontSize);
```

- `fileName`: 即字体文件的路径。
- `fontName`: 用于标识不同的字体，注意不能重复。
- `fontSize`: 创建的字体的大小。

### 获取文字的纹理

我们可以通过提供文字获取其对应的纹理，但是需要注意的是，纹理只有关于这个文字的数据信息，而没有排版的数据信息，因此不同的文字对应的纹理其宽度或者高度都有可能不同。

```C++
    auto characterCodeMetrics = font->GetCharacterCodeMetrics(code);
```

以上函数的参数是一个UTF-16编码的字符，为什么是UTF-16？因为如果使用UTF8的话，那么单个字符需要多个byte才能够描述，因此我们使用的是UTF-16，既可以将所有常用的文字通过一个变量表达。而返回值则是关于这个文字的纹理其对应的数据。具体可以去参见文档或者源码。

## 文本

因为文本的排版比较的麻烦，因此引擎提供了一个简单的排版类型。

### 创建文本

```C++
    auto text = new Text(str, font, maxWidth, maxHeight);
```

- `str`: 文本内容，注意编码为UTF-8。
- `font`：使用的字体。
- `maxWidth`: 文本的宽度限制，如果设置为0的话，那么就代表文本只有一行。
- `maxHeight`: 文本的高度限制，如果设置为0的话，那么就由引擎来计算出合适的高度。

如果我们的文本内容太长，导致在限制内无法渲染完成，那么超出部分将不会被渲染。

### 使用文本

我们创建文本后，如果想要使用文本的话，只需要获取其对应的纹理，然后将其加入到合并纹理中去，当作普通的纹理使用就可以了。但是有两点需要注意。

- 文本纹理的格式是A8类型，因为我们没有存储颜色数据，因此我们的合并纹理的格式也必须是A8格式。

```C++
    auto texture = text->GetTexture();
```

## UI层

我们之前在设置物体的时候要求指定物体所在的层，之前我们使用的都是World层，而现在我们还有一个UI层，表示我们的物体作为UI使用。在UI层的物体不会考虑物理碰撞，不会考虑摄像机的影响，而坐标系则是直接参考窗口坐标(范围限制参考世界的分辨率)。

## 文本的使用

和1.0版本不同的是，1.03beta对于文本的使用更加的方便，我们只需要在PixelObject中设置好文本内容，使用的字体，以及文本的颜色后，即可将字体渲染出来(将会居中)。

```C++

object->TextColor = glm::vec3(1, 0, 0);
object->Font = font;
object->Text = u8"This is an example about render Text!";

```

## 样例

- [EngineText](https://github.com/LinkClinton/PixelWorldEngineSample/tree/master/EngineText)